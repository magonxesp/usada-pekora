version: "3"

services:
  backend:
    restart: unless-stopped
    build:
      context: backend
      dockerfile: Dockerfile
    depends_on:
      - backend_database
    environment:
      DATABASE_HOST: backend_database
      DATABASE_PORT: 3306
      DATABASE_NAME: pekora_backend
      DATABASE_USERNAME: pekora_backend_usr
      DATABASE_PASSWORD: pekora_backend_pw

  discord_bot:
    build:
      context: discord-bot
      dockerfile: Dockerfile
    restart: unless-stopped
    depends_on:
      - backend
      - discord_bot_database
      - discord_bot_cache
    environment:
      DISCORD_BOT_TOKEN: ""
      BACKEND_BASE_URL: ""
      BACKEND_TOKEN: ""

  backend_database:
    image: mysql:5.7.39
    restart: unless-stopped
    volumes:
      - backend_database:/var/lib/mysql
    environment:
      MYSQL_DATABASE: pekora_backend
      MYSQL_USER: pekora_backend_usr
      MYSQL_PASSWORD: pekora_backend_pw
      MYSQL_ROOT_PASSWORD: root

  discord_bot_database:
    image: mongo:4.2.22
    restart: unless-stopped
    volumes:
      - discord_bot_database:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example

  discord_bot_cache:
    image: redis:7.0.4
    restart: unless-stopped

volumes:
  backend_database:
  discord_bot_database:
